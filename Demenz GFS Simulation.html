<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demenz Simulation - Bio LK</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevent scrolling during simulation */
        }

        /* Effekte für die verschiedenen Stadien */
        .stage-1-blur { filter: blur(0.5px); }
        .stage-2-blur { filter: blur(1.5px) grayscale(40%); }
        .stage-3-blur { filter: blur(3px) grayscale(80%) contrast(120%); animation: pulse-vision 5s infinite; }
        .stage-4-blur { filter: blur(4px) grayscale(95%) contrast(150%); animation: tunnel-vision 8s infinite; }

        .shake-gentle { animation: shake 3s infinite; }
        .shake-hard { animation: shake 0.4s infinite; }

        @keyframes shake {Ä
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        @keyframes pulse-vision {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }
        
        @keyframes tunnel-vision {
             0% { box-shadow: inset 0 0 50px #000; }
             50% { box-shadow: inset 0 0 150px #000; }
             100% { box-shadow: inset 0 0 50px #000; }
        }

        /* Schwimmender Text für Gedanken */
        .thought {
            position: absolute;
            color: rgba(0,0,0,0.5);
            font-weight: bold;
            pointer-events: none;
            z-index: 5;
            white-space: nowrap;
            animation: floatUp 5s linear forwards;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            10% { opacity: 0.8; }
            80% { opacity: 0.8; }
            100% { transform: translateY(-150px) scale(1.1); opacity: 0; }
        }

        .cursor-lag {
            transition: all 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-slate-100 h-screen w-screen flex flex-col items-center justify-center text-slate-800 select-none">

    <!-- Start Screen -->
    <div id="start-screen" class="max-w-2xl text-center p-8 bg-white rounded-xl shadow-2xl overflow-y-auto max-h-screen">
        <h1 class="text-4xl font-bold mb-4 text-slate-900">Demenz Simulation</h1>
        <p class="text-lg mb-6 text-slate-600">GFS Philipp Huber 27.11.2025
            <br>
            <strong></strong>
            <br><br>
            <strong>Aufgabe:</strong> Finde die geforderten Gegenstände so schnell wie möglich. Es wird über mehrere Runden zunehmend schwieriger.
        </p>
        <div class="grid grid-cols-1 gap-3 text-left bg-slate-50 p-4 rounded-lg mb-8 text-sm border border-slate-200">
            <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-blue-500 mr-2"></span> Phase 1: Gesund (Normalzustand)</div>
            <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-yellow-500 mr-2"></span> Phase 2: Mild Cognitive Impairment (Vergesslichkeit)</div>
            <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-orange-500 mr-2"></span> Phase 3: Mittelschwere Demenz (Wortfindungsstörungen)</div>
            <div class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-600 mr-2"></span> Phase 4: Schwere Demenz (Desorientierung & Chaos)</div>
        </div>
        <button onclick="startGame()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-10 rounded-full transition transform hover:scale-105 shadow-lg">
            Simulation starten
        </button>
    </div>

    <!-- Game UI (Hidden initially) -->
    <div id="game-ui" class="hidden w-full max-w-5xl h-full flex flex-col p-4 relative">
        
        <!-- Header Info -->
        <div class="flex justify-between items-center mb-4 bg-white p-4 rounded-lg shadow-md z-20 border-b-4 border-slate-200">
            <div>
                <h2 id="stage-title" class="text-xl font-bold text-slate-800">Phase 1: Gesund</h2>
                <div class="flex items-center gap-2 mt-1">
                    <span class="text-xs font-bold uppercase tracking-wide text-slate-400">Aktuelle Aufgabe:</span>
                    <span id="round-indicator" class="text-xs bg-slate-200 px-2 py-0.5 rounded-full text-slate-600">1 / 3</span>
                </div>
                <p id="instruction-wrapper" class="mt-2 text-lg text-slate-600 transition-opacity duration-500">
                    Finde: <span id="target-item" class="font-bold text-blue-600 text-2xl bg-blue-50 px-2 rounded">...</span>
                </p>
            </div>
            <div class="text-right">
                <div class="text-xs text-slate-400 uppercase tracking-wider">Verbleibende Zeit</div>
                <div id="timer" class="text-4xl font-mono font-bold text-slate-800">15</div>
            </div>
        </div>

        <!-- Medical Overlay (Symptoms) -->
        <div id="overlay-effect" class="absolute inset-0 pointer-events-none z-10 transition-all duration-1000"></div>

        <!-- Grid Area -->
        <div id="grid-container" class="flex-grow grid grid-cols-3 md:grid-cols-4 gap-4 p-2 transition-all overflow-y-auto">
            <!-- Items injected via JS -->
        </div>

        <!-- Feedback Message -->
        <div id="feedback" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-5xl font-bold hidden z-50 drop-shadow-2xl text-center"></div>
    </div>

    <!-- Inter-Level Report Screen -->
    <div id="report-screen" class="hidden absolute inset-0 bg-white z-50 flex flex-col items-center justify-center p-8 overflow-y-auto">
        <div class="max-w-2xl w-full">
            <h2 class="text-3xl font-bold mb-2 text-slate-800">Phasen-Abschluss</h2>
            <div class="h-1 w-20 bg-blue-500 mb-6"></div>
            
            <div class="bg-white p-6 rounded-xl shadow-xl border border-slate-100 mb-8">
                <h3 id="symptom-title" class="text-xl font-bold mb-4 text-blue-800">Symptome & Beobachtung</h3>
                <p id="symptom-desc" class="text-slate-700 leading-relaxed text-lg">...</p>
            </div>

            <div class="bg-slate-50 p-4 rounded-lg mb-8 text-sm text-slate-500 italic border-l-4 border-slate-300">
                <p>"Im nächsten Stadium verschlechtern sich die Symptome. Achte auf Veränderungen in der Wahrnehmung."</p>
            </div>

            <div class="flex justify-center">
                <button onclick="startNextPhase()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-4 px-12 rounded-full text-lg shadow-lg transition hover:-translate-y-1">
                    Nächste Phase starten
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- GAME DATA ---
        // Expanded item list for more variety
        const itemsData = [
            { id: 'apple', name: 'Apfel', icon: 'apple' },
            { id: 'key', name: 'Schlüssel', icon: 'key' },
            { id: 'pill', name: 'Tablette', icon: 'pill' },
            { id: 'glasses', name: 'Brille', icon: 'glasses' },
            { id: 'clock', name: 'Uhr', icon: 'clock' },
            { id: 'phone', name: 'Telefon', icon: 'phone' },
            { id: 'book', name: 'Buch', icon: 'book' },
            { id: 'coffee', name: 'Kaffee', icon: 'coffee' },
            { id: 'home', name: 'Haus', icon: 'home' },
            { id: 'car', name: 'Auto', icon: 'car' },
            { id: 'camera', name: 'Kamera', icon: 'camera' },
            { id: 'scissors', name: 'Schere', icon: 'scissors' },
            { id: 'shoe', name: 'Schuh', icon: 'footprints' }, 
            { id: 'light', name: 'Licht', icon: 'lightbulb' },
            { id: 'mail', name: 'Brief', icon: 'mail' },
            { id: 'gift', name: 'Geschenk', icon: 'gift' }
        ];

        const stages = [
            {
                // Phase 1: Gesund - zum Aufwärmen
                title: "Phase 1: Gesund",
                rounds: 3,
                timePerRound: 10,
                blur: 0,
                scrambleText: false,
                hideInstructions: false,
                shake: false,
                intrusiveThoughts: false,
                gridSize: 9, // 3x3 (subset of items)
                desc: "<b>Status:</b> Das Gehirn arbeitet normal.<br><br>Du konntest die Gegenstände problemlos finden. Die visuelle Verarbeitung und das Kurzzeitgedächtnis funktionieren super."
            },
            {
                // Phase 2: MCI - Erstes Vergessen
                title: "Phase 2: leichte kognitive Beeinträchtigung",
                rounds: 4,
                timePerRound: 8,
                blur: 3, // Leicht unscharf
                scrambleText: false,
                hideInstructions: true, // Das ist der Test fürs Kurzzeitgedächtnis
                shake: false,
                intrusiveThoughts: false,
                gridSize: 12, 
                desc: "<b>Status:</b> Hippocampus-Funktion eingeschränkt.<br><br>Hast du gemerkt, dass die Anweisung verschwindet? Das simuliert Defizite im Kurzzeitgedächtnis. Man weiß plötzlich nicht mehr, was man eigentlich tun wollte."
            },
            {
                // Phase 3: Mittelschwere Demenz - Wortfindung & Agnosie
                title: "Phase 3: Mittelschwere Demenz",
                rounds: 5,
                timePerRound: 7,
                blur: 3,
                scrambleText: true, // Vokale fehlen (Aphasie)
                hideInstructions: true,
                shake: 'gentle', // Leichte Unruhe
                intrusiveThoughts: true, // Ablenkung
                gridSize: 12,
                desc: "<b>Status:</b> Temporallappen und Parietallappen betroffen.<br><br><b>Aphasie:</b> Wörter zerfallen (Buchstaben fehlen).<br><b>Agnosie:</b> Gegenstände sind schwerer zu erkennen.<br>Störende Gedanken unterbrechen die Konzentration."
            },
            {
                // Phase 4: Schwere Demenz - Chaos
                title: "Phase 4: Schwere Demenz",
                rounds: 5,
                timePerRound: 5,
                blur: 3,
                scrambleText: 'severe', // Kaum lesbar
                hideInstructions: true,
                shake: 'hard', // Starke motorische Unruhe
                intrusiveThoughts: true,
                gridSize: 12,
                desc: "<b>Status:</b> Fortgeschrittene Neurodegeneration.<br><br>Die Welt wirkt chaotisch und bedrohlich. Orientierung ist kaum noch möglich. Einfache Handlungen werden sehr schwer."
            }
        ];

        // --- STATE ---
        let currentStageIndex = 0;
        let currentRound = 0;
        let currentTarget = null;
        let timerInterval;
        let thoughtInterval;
        let timeLeft = 0;
        let itemsOnScreen = [];

        // --- INIT ---
        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            currentStageIndex = 0;
            startPhase(currentStageIndex);
        }

        function startPhase(index) {
            currentStageIndex = index;
            currentRound = 0;
            // Report Screen ausblenden
            document.getElementById('report-screen').classList.add('hidden');
            
            if (currentStageIndex >= stages.length) {
                showEndScreen();
                return;
            }

            // UI für neue Phase vorbereiten
            const stage = stages[currentStageIndex];
            
            // Effekte setzen
            const overlay = document.getElementById('overlay-effect');
            overlay.className = 'absolute inset-0 pointer-events-none z-10 transition-all duration-1000'; // reset
            if (currentStageIndex === 1) overlay.classList.add('stage-1-blur');
            if (currentStageIndex === 2) overlay.classList.add('stage-2-blur');
            if (currentStageIndex === 3) overlay.classList.add('stage-3-blur');
            if (currentStageIndex === 4) overlay.classList.add('stage-4-blur'); // Fallback für Erweiterungen

            startRound();
        }

        function startRound() {
            const stage = stages[currentStageIndex];
            currentRound++;

            // Check if phase complete
            if (currentRound > stage.rounds) {
                showPhaseReport();
                return;
            }

            // Update Header
            document.getElementById('stage-title').innerText = stage.title;
            document.getElementById('round-indicator').innerText = `${currentRound} / ${stage.rounds}`;
            
            timeLeft = stage.timePerRound;
            updateTimerDisplay();

            // Select random items for this grid based on gridSize
            // Shuffle full list then slice
            const shuffledAll = [...itemsData].sort(() => Math.random() - 0.5);
            itemsOnScreen = shuffledAll.slice(0, stage.gridSize);

            // Pick a target from the items currently ON SCREEN
            const targetIndex = Math.floor(Math.random() * itemsOnScreen.length);
            currentTarget = itemsOnScreen[targetIndex];

            // Setup Instructions
            const wrapper = document.getElementById('instruction-wrapper');
            const targetEl = document.getElementById('target-item');
            
            let displayTargetName = currentTarget.name;
            if (stage.scrambleText === true) displayTargetName = scrambleText(displayTargetName);
            if (stage.scrambleText === 'severe') displayTargetName = scrambleTextSevere(displayTargetName);

            targetEl.innerText = displayTargetName;
            
            // Reset opacity for instructions
            wrapper.style.opacity = '1';
            
            // Render Grid
            renderGrid(stage);

            // Hide instruction logic (Hippocampus simulation)
            if (stage.hideInstructions) {
                setTimeout(() => {
                    wrapper.style.opacity = '0'; 
                }, 2500); // 2.5 Sekunden zum Merken
            }

            // Timers
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    handleTimeUp();
                }
            }, 1000);

            // Thoughts
            clearInterval(thoughtInterval);
            if (stage.intrusiveThoughts) {
                const freq = currentStageIndex === 3 ? 1200 : 2500;
                thoughtInterval = setInterval(spawnThought, freq);
            }
        }

        function handleTimeUp() {
            clearInterval(timerInterval);
            clearInterval(thoughtInterval);
            
            const feedback = document.getElementById('feedback');
            feedback.innerHTML = "<span class='text-red-600'>Vergessen...</span>";
            feedback.classList.remove('hidden');
            
            setTimeout(() => {
                feedback.classList.add('hidden');
                startRound(); // Next round despite failure (frustration loop)
            }, 1500);
        }

        function renderGrid(stage) {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';
            
            // Determine grid columns based on count
            if (stage.gridSize > 9) {
                container.classList.remove('grid-cols-3');
                container.classList.add('grid-cols-3', 'md:grid-cols-4');
            } else {
                container.classList.remove('grid-cols-4');
                container.classList.add('grid-cols-3');
            }

            itemsOnScreen.forEach(item => {
                const btn = document.createElement('button');
                let classes = "bg-white p-2 rounded-xl shadow-lg flex flex-col items-center justify-center transition active:scale-95 h-28 relative group overflow-hidden border border-slate-200 hover:bg-slate-50";
                
                if (stage.shake === 'gentle') classes += " shake-gentle";
                if (stage.shake === 'hard') classes += " shake-hard";

                btn.className = classes;
                btn.onclick = () => checkClick(item.id);

                let isConfused = stage.blur >= 2;
                
                let label = item.name;
                if (stage.scrambleText === true) label = scrambleText(label);
                if (stage.scrambleText === 'severe') label = '???';

                const iconMap = {
                    'apple': 'apple', 'key': 'key', 'pill': 'pill', 
                    'glasses': 'glasses', 'clock': 'clock', 'phone': 'phone', 
                    'book': 'book', 'coffee': 'coffee', 'home': 'home',
                    'car': 'car', 'camera': 'camera', 'scissors': 'scissors',
                    'shoe': 'footprints', 'light': 'lightbulb', 'mail': 'mail', 'gift': 'gift'
                };

                // In severe stages, color perception fades
                let colorClass = "text-blue-500";
                if (stage.blur === 2) colorClass = "text-slate-500";
                if (stage.blur === 3) colorClass = "text-slate-300";

                const iconHtml = `<i data-lucide="${iconMap[item.id] || 'circle'}" class="w-8 h-8 mb-2 ${colorClass}"></i>`;

                btn.innerHTML = `${iconHtml}<span class="text-xs font-semibold ${isConfused ? 'text-slate-400' : 'text-slate-700'}">${label}</span>`;
                
                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        function checkClick(id) {
            if (id === currentTarget.id) {
                // Correct
                clearInterval(timerInterval);
                clearInterval(thoughtInterval);
                
                const feedback = document.getElementById('feedback');
                feedback.innerHTML = "<span class='text-green-600'>Gefunden!</span>";
                feedback.classList.remove('hidden');
                
                setTimeout(() => {
                    feedback.classList.add('hidden');
                    startRound();
                }, 800);
            } else {
                // Wrong
                timeLeft = Math.max(0, timeLeft - 2);
                updateTimerDisplay();
                
                // Visual shake of the UI
                const container = document.getElementById('game-ui');
                container.classList.add('translate-x-2');
                setTimeout(() => container.classList.remove('translate-x-2'), 100);
            }
        }

        function showPhaseReport() {
            clearInterval(timerInterval);
            clearInterval(thoughtInterval);
            
            const stageInfo = stages[currentStageIndex];
            document.getElementById('symptom-title').innerText = `Analyse: ${stageInfo.title}`;
            document.getElementById('symptom-desc').innerHTML = stageInfo.desc;
            
            document.getElementById('report-screen').classList.remove('hidden');
        }

        function startNextPhase() {
            startPhase(currentStageIndex + 1);
        }

        function showEndScreen() {
             document.getElementById('game-ui').innerHTML = `
                <div class="h-full flex flex-col items-center justify-center p-8 bg-slate-50">
                    <div class="bg-white p-10 rounded-2xl shadow-2xl max-w-2xl text-center">
                        <div class="mb-6 flex justify-center">
                            <i data-lucide="brain-circuit" class="w-20 h-20 text-blue-600"></i>
                        </div>
                        <h2 class="text-4xl font-bold mb-4 text-slate-800">Simulation beendet</h2>
                        <p class="text-lg mb-6 text-slate-600 leading-relaxed">
                            Du hast die Desorientierung und den Stress erlebt, den Patienten täglich empfinden.
                            <br><br>
                           Für Betroffene ist das ein dauerhafter Zustand.
                        </p>
                        <div class="bg-blue-50 p-6 rounded-xl text-left text-sm text-blue-900 mb-8">
                            <strong>Für die Diskussion (Bio LK):</strong>
                            <ul class="list-disc ml-5 mt-2 space-y-1">
                                <li>Welche Hirnareale waren in Phase 2 (MCI) betroffen?</li>
                                <li>Wie wirkten sich die visuellen Störungen auf die Reaktionszeit aus?</li>
                                <li>Warum führen diese Defizite oft zu Angst oder Aggression?</li>
                            </ul>
                        </div>
                        <button onclick="location.reload()" class="bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 px-8 rounded-lg transition">
                            Zurück zum Start
                        </button>
                    </div>
                </div>
            `;
            lucide.createIcons();
        }

        function updateTimerDisplay() {
            const el = document.getElementById('timer');
            el.innerText = timeLeft;
            if (timeLeft <= 3) el.classList.add('text-red-600', 'animate-pulse');
            else el.classList.remove('text-red-600', 'animate-pulse');
        }

        // --- UTILS & FX ---

        function scrambleText(text) {
            // Remove vowels 
            return text.replace(/[aeiouäöüAEIOUÄÖÜ]/g, '_');
        }

        function scrambleTextSevere(text) {
            // Complete gibberish but keep length roughly same
            const chars = text.split('');
            return chars.map(c => Math.random() > 0.3 ? String.fromCharCode(97 + Math.floor(Math.random() * 26)) : c).join('');
        }

        const thoughts = [
            "Was wollte ich?", "Wer ist das?", "Ich will heim.", 
            "Wo ist Mama?", "Habe ich Hunger?", "Es ist so laut.", 
            "Hilfe.", "Mein Geld!", "Welches Jahr?", "Verstehe nicht.", "Angst."
        ];

        function spawnThought() {
            const t = document.createElement('div');
            t.className = 'thought';
            t.innerText = thoughts[Math.floor(Math.random() * thoughts.length)];
            
            // Random position but kept somewhat central to annoy user
            const x = 50 + Math.random() * (window.innerWidth - 100);
            const y = window.innerHeight / 2 + (Math.random() * 200 - 100);
            
            t.style.left = x + 'px';
            t.style.top = y + 'px';
            // Random font size for chaos
            t.style.fontSize = (1 + Math.random()) + 'rem';
            
            document.body.appendChild(t);
            
            setTimeout(() => t.remove(), 4900);
        }

    </script>
</body>
</html>
